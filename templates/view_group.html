{% extends "base.html" %}
{% load static %}

{% block style %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
{% endblock %}

{% block title %} {{ group.name }} {% endblock %}

{% block content %}
        <!-- ‚úÖ ‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏° (‡∏ã‡πâ‡∏≤‡∏¢) -->
        <div class="group-details">
            <h1>{{ group.name }}</h1>
            <p><strong>Description:</strong> {{ group.description }}</p>
            <p><strong>Created by:</strong> {{ group.created_by.username }}</p>
            <p><strong>Created on:</strong> {{ group.created_at|date:"d M Y" }}</p>
            <br>
            <a href="{% url 'group_admin_dashboard' %}" class="btn-back-home">Back</a>
            <a href="{% url 'add_member' group.id %}" class="btn-join-group">Add Member</a>
        </div>
{% endblock %}

{% block content2 %}
<div class="member-container">
  <h2>Member: {{ group.name }}</h2>

  <div id="group-data">
    {% for member in members %}
      <div class="member-box" id="member-{{ member.id }}">
        <p>
          <strong>{{ member.username }}</strong> |
          <a href="{% url 'user_profile' member.id %}">View Profile</a>
        </p>
        <div class="sensor-title">{{ member.username }}</div>
        <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå...</p>
      </div>
    {% endfor %}
  </div>

  <script>
    const socket = new WebSocket("ws://" + window.location.host + "/ws/sensor/");
    socket.onopen = () => console.log("‚úÖ WebSocket connected");
    socket.onerror = err => console.error("‚ùå WebSocket error:", err);

    socket.onmessage = function(e) {
      const data = JSON.parse(e.data);
      console.log("üî• WebSocket:", data);

      const userId = data.user_id;
      const element = document.getElementById("member-" + userId);
      if (element) {
        let riskColor = "#ccc";
        if (data.risk === "low") riskColor = "#9ae69a";     // üü© ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß
        else if (data.risk === "medium") riskColor = "#f7e177"; // üü® ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á
        else if (data.risk === "high") riskColor = "#f17c7c";   // üü• ‡πÅ‡∏î‡∏á

        element.style.backgroundColor = riskColor;
        element.innerHTML = `
  <div class="sensor-title">${data.username || '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ID ' + userId}</div>

  <div style="background-color: ${riskColor}; padding: 0.8rem; border-radius: 8px;">
    <p><strong>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á:</strong> ${data.risk.toUpperCase()}</p>
    <p>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${data.timestamp}</p>
    <ul>
      <li>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡πâ‡∏ô‡∏´‡∏±‡∏ß‡πÉ‡∏à: ${data.heart_rate} bpm</li>
      <li>‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ú‡∏¥‡∏ß: ${data.skin_temperature} ¬∞C</li>
      <li>‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÇ‡∏î‡∏¢‡∏£‡∏≠‡∏ö: ${data.ambient_temperature} ¬∞C</li>
      <li>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô: ${data.humidity} %</li>
      <li>‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≤‡∏ô‡∏ó‡∏≤‡∏ô‡∏ú‡∏¥‡∏ß‡∏´‡∏ô‡∏±‡∏á: ${data.skin_resistance}</li>
    </ul>
  </div>

  <a class="profile-btn" href="/profile/${userId}/">‡∏î‡∏π‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</a>
`;

      }
    };
  </script>
  
</div>
{% endblock %}
